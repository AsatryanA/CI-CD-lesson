pipeline {
  agent any
  stages {
    stage('SonarQube check') {
      steps {
        withSonarQubeEnv(installationName: 'sq1') {
            bat 'mvn clean compile test sonar:sonar'
        }
      }
    }
    stage('Test coverage by JaCoCo') {
      steps {
        jacoco()
      }
    }
    stage('Build before deploy') {
       steps {
         bat 'mvn package'
          }
        }
    stage('Deploy to .war') {
      steps {
        deploy adapters: [tomcat9(credentialsId: 'deployer', path: '', url: 'http://localhost:8080/')],
      contextPath: 'jenkins-task', onFailure: false, war: '**/*.war'
      }
    }
  }
}